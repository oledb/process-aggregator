
# Документация

## Содержание

* [Философия проекта](./README.md#философия-проекта)
* [Начало работы](./getting-started.md)
* [Низкоуровневые сценарии](./low-level-scenario.md)
* [Высокоуровневые сценарии](./high-level-scenario.md)
* [Public API](./public-api.md)
* [Rest API](./rest-api.md)
* [Roadmap](./roadmap.md)

## Философия проекта

## Общая структура процесса

## Ключевые элементы процесса

* Процесс (Process) - набор связанных шагов, по которым движется задача. Представляет из себя граф, привязан к коду. Все остальные сущности (команды, действия, связи, шаги) являются частью процесса. Для создания процесса необходим контекст. Зона ответственности - управлять взаимодействиями всех остальных частей.
* Задача (Task) - конкретная задача, которая движется по процессу. Представляет собой объект JSON, хранится в БД. Зона ответственности - хранить состояние.
* Статус (Status) - ключевое поле, через которое связывается задача, шаг и команда.
* Содержимое (Payload) задачи - содержит любой набор полезных данных, которые могут изменяться как в процессе движения задачи по статусам, так и отдельно.
* Шаг (Step) - часть процесса, представляет собой узел (node) в графе. Основное ключевое поле - статус. По нему Задача понимает, к какому шагу она привязана. Зона ответственности - взаимодействие со связями.
* Связь (Relation) - часть процесса, представляет собой грань (edge) графа. Связывает шаги друг с другом. Зона ответственности - определять возможность перехода на другие шаги через взаимодействие с действиями.
* Вес связи (Relation Weight) - часть процесса, представляет собой вес (weight) ребра графа. Связывает шаги между собой, содержит ключевое поле - команду.
* Команда (Command) - вес (weight) связи в графе, представляет собой строку. Благодаря командам можно понять, какое действие (action) нужно вызывать.
* Действие (Action) - класс, который отвечает за валидацию своего выполнения и за перевод задачи на другой шаг. Зона ответственности - перевод задачи на другой шаг путем взаимодействия с различными внешними источниками (базы данных, очереди, микросервисы). Основное предназначение действия - это дать возможность узнать клиенту, что на конкретном шаге возможно сделать определенные изменения задачи или ее состояние и выполнить такие изменения.

# Документы и ссылки

* [RFC 6902 - JavaScript Object Notation (JSON) Patch](https://datatracker.ietf.org/doc/html/rfc6902)

## CRUD

* Create - новая заявка создается через `IInitialAction`
* Read action - доступность команды можно получить через `IAction.validateTask`
* Read task - проверить доступность задачи на определенном шаге можно получить через `IReadOperation.`
* Update task
  *  `IAction.updateTask` - обновление статуса и опционально, обновление содержимого (Payload)

# Описание REST API

* `POST /api/process/:process/tasks/payload` - передается payload, который создает задачу
* `GET /api/process/:process/tasks?q=...` - получения списка задач
* `GET /api/process/:process/tasks/:id` - возвращает задачу по id
* `PUT /api/process/:process/tasks/:id/payload` - обновляет существующую задачу
* `POST /api/process/:process/tasks/command/:command/` - запускает выполнение команды


